\section{ステッパの動作}

本研究のステッパは、表面上は著者らがかつて実装したステッパ\cite{FSA18}と同じ動作をするが、内部での処理方法および速さが大きく異なる。本節では、既存のステッパと本研究の新しいステッパの動作について説明する。

いずれのステッパも、実行可能な１つのプログラムを対象としている。

\subsection{DrRacketのステッパ}
\label{ステッパの動作-DrRacketのステッパ}
DrRacket のステッパ\cite{clements01}は、ユーザが入力したプログラムを全ステップの情報を生成するプログラムへ変換し、それを実行してステップの情報を蓄えながら、ユーザの操作に従って１つのステップを表示する。実行開始に少し遅れて、表示のための処理を並列して行うことになる。

\subsection{incremental でない OCaml ステッパ}
\label{ステッパの動作-incrementalでないOCamlステッパ}
先行研究である著者らがかつて実装したステッパ\cite{FSA18}では、インタプリタにステップ出力機能を足したものに入力プログラムを渡し、全ステップの文字列を生成する。プログラムを全て実行するかステップ数の上限に達すると実行を終了し、最初のステップを表示し、ユーザの操作に従って表示するステップを変える。

インタプリタは新しく著者らが作った OCaml の関数であり、通常のインタプリタよりも実行速度が遅い。そこにさらに出力機能を足したインタプリタによるプログラム実行が終わるまで表示が始まらないため、実行に時間がかかるプログラムのステップ実行をするには長い時間待つ必要がある。

\subsection{提案するステッパ}
\label{ステッパの動作-提案するステッパ}

本研究で提案するステッパは、インタプリタにステップ出力機能を足したものに入力プログラムを渡し、１ステップの簡約を計算したらただちにそのステップを出力し、続きの実行は行わずにプロセスを終了する。ユーザから次のステップを表示するなどの命令がされ次第、前回の出力の一部を新しい入力として受け取って次の１ステップ実行をする。

例えば、\texttt{2 * 3 + 5 * 7} というプログラムを入力されると、incremental でないステッパは \texttt{2 * 3 + 5 * 7 $\leadsto$ 2 * 3 + 35 $\leadsto$ 6 + 35 $\leadsto$ 41} という3ステップを出力するのに対して、incremental なステッパは \texttt{2 * 3 + 5 * 7 $\leadsto$ 2 * 3 + 35} の1ステップを出力する。次のステップを表示する命令がされたときに、外部のプログラムがそこから \texttt{2 * 3 + 35} という部分を抜き出して再度ステッパに入力することでその次のステップを得る。

incremental なステッパには、メモリに膨大なステップの情報を保存する必要がない、ユーザが見ないステップは計算されないという特徴がある。

