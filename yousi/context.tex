\section{ステッパの実装とコンテキスト}
\label{section:context}

ステッパはインタプリタの一種であるため，通常のインタプリタ関数に機能を付け加えることで実装することができる．

ところが，通常のインタプリタの構造では，書き換わる部分以外の情報を参照できないという問題がある．
図\ref{figure:step_example} の例では，インタプリタは再帰的に部分式を実行し，
最初に計算を進められる部分である \texttt{(1 + 2)} を計算して，値 \texttt{3} を得る．
その時にステッパは図\ref{figure:step_example}の最初の2行を出力したいが，
\texttt{(1 + 2)} を再帰的に実行している最中なので，
周りの式 \texttt{let a = [.]\ in (4 + a)} の情報はスタックにしかなく，
出力することができない．
この周りの式のことをコンテキストと呼ぶ．

つまり，ステッパを実装するためにはコンテキストの情報が必要なので，
その情報を得るためにインタプリタプログラムが全体の中のどこを実行しているのかという情報を明示的に扱えるようにしたい．
我々は以前\cite{FCA19}，コンテキストを表すデータ型を定義し，
インタプリタ関数の再帰呼び出し時の構造に合わせて引数として渡すようにすることで，コンテキストの情報を明示的に保持させるようにした．
明示的に扱えるコンテキストの情報があればその段階でのプログラム全体を再構成できるので，それを出力することでステッパを実装することができた．

しかしコンテキストを表すデータ型は言語ごとに定義する必要があり，その構造は自明なものとは限らない．
そこで本研究では，
通常のインタプリタに機械的な変換を施すことで
コンテキストの情報を持つインタプリタおよびコンテキストのためのデータ型を導出し，
それを利用してステッパを実装する方法を提案する．
