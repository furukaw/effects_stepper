\section{はじめに}

プログラムの実行の様子を確認する方法に、実行が1段階進むごとにどのよう
なプログラムになっているのかを書き連ねる方法がある。このツールは、代数的ス
テッパ（以後、単にステッパと書く）と呼ばれ、プログラムが代数的に書き換
わる様子を1ステップずつ表示してくれるものである。
例えば OCaml のプログラム \texttt{let a = 1 + 2 in 4 + a} を入力される
と、ステッパは以下のような実行ステップを表す文字列を出力する。

\vspace{-5pt}
\begin{spacing}{0.9}
\begin{alltt}
Step 0:  (let a = \colorbox{lightgreen}{(1 + 2)} in (4 + a))
Step 1:  (let a = \colorbox{purple}{3} in (4 + a))
Step 1:  \colorbox{lightgreen}{(let a = 3 in (4 + a))}
Step 2:  \colorbox{purple}{(4 + 3)}
Step 2:  \colorbox{lightgreen}{(4 + 3)}
Step 3:  \colorbox{purple}{7}
\end{alltt}
\end{spacing}
\vspace{-5pt}

このように1段階ずつ確認していけば、具体的にどのような計算がされるのか
を観察することができ、プログラムの動きを理解しやすい。またこの方法はデ
バッグにおいても有用で、どの段階で想定と違うことが起こっているのかが見
えるので、プログラムのどの部分がその原因なのかが分かりやすくなる。
特に、ステッパの操作は前後のステップへの移動のみであり、デバッガの
コマンドを覚えたりブレークポイントを適切に設定するような難しい操作を
必要としないので、プログラミングや CUI で の操作に慣れていない初心者でも使いやすい。
お茶の水女子大学では実際に関数型言語の授業でステッパを本格的に使
用しており、ある程度学習に役立っている \cite{FCA19}。

しかし、継続を操作するようなプログラムだった場合、ステッパをどのように
作ったら良いのかは明らかではない。そのような複雑なプログラムでこそ実行
の様子を詳細に追いたいところだが、現在のところそのような言語に対するス
テッパは作られていない。
わずかに、我々が過去の研究 \cite{FCA19} で例外処理のための
構文 try-with を含む言語についてのステッパを実装した程度である。

そこで我々は、ステッパを、継続を明示的に扱う言語機能に対応させることを
目指している。ステッパは、通常のインタプリタ関数に出力機能を追加するこ
とで実装できるが、その際、式全体を再構成するためにコンテキストの情報が
必要になる。以前の研究 \cite{FCA19} では、部分式の簡約に進むたびにコン
テキストを表すデータ型を作成していたが、継続を操作するようなプログラム
の場合、どのようなコンテキストにすれば良いのかは即座には明らかではな
い。

本論文の貢献点は次の通りである。
まず第一に、algebraic effect handlers に対する big step インタプリタを定義した。
このインタプリタは、従来知られていたものと異なり、継続が高階関数の形で
表現された CPS インタプリタになっている。
第二に、algebraic effect handlers を含む言語について、
インタプリタにCPS変換 \cite{PLOTKIN1975125}と非関数化
\cite{Reynolds1998}を施すことでコンテキスト情報を導出した。
本論文では詳しくは述べないが、この手法は shift/reset に対する
ステッパの作成にも使うことができる。

本論文の構成は以下の通りである。
まず \ref{section:context} 節でステッパを実装する方法を紹介する。
そして \ref{section:definition} 節で algebraic effect handlers を含む言語およびそのインタプリタを定義し、
\ref{section:transform} 節でインタプリタを変換してステッパを得るまでの過程を説明する。
\ref{section:languages} 節では他のいくつかの言語に対するステッパを同様の変換によって得ることについて議論する。
\ref{section:related} 節で関連研究について触れ、\ref{section:conclusion} 節でまとめる。
